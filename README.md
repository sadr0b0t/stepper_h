# stepper_h
Non-blocking stepper motor control library for ChipKIT (Arduino-compatible pic32-based dev board)

Hello,

Here is my library to control multiple stepper motors connected to ChipKIT board via step-dir driver interface
https://github.com/1i7/stepper_h

The major benefit in comparison to Arduino Stepper.h lib https://www.arduino.cc/en/Reference/StepperStep is that my stepper_h calls are non-blocking: you can run simultaneously multiple motors and receive commands via Wify, Serial port and do anything else in the main loop at the same time.

It uses PIC32 timer interrupts to generate step signals in background (basic code to init timer taken from ChipKIT Servo.h library port) and ChipKIT/Arduino API to deal with pins, so it would work only on ChipKIT boards with Arduino-compatible firmware (will not work on classic Arduino or pure PIC32 chip).

to install, just make git clone https://github.com/1i7/stepper_h to ~/Arduino/libraries (for the new ChipKIT IDE)

```bash
cd ~/Arduino/libraries
git clone https://github.com/1i7/stepper_h.git
```

basic example should appear in Arduino examples menu: File/Examples/stepper_h/stepper_h

This one runs 3 stepper motors with different speed at the same time. Motors start to run after calling stepper_start_cycle(). Note, that loop can contain any code (or have no code at all) - the motors would work in background.
```c++
#include "stepper.h"

// Stepper motors
static stepper sm_x, sm_y, sm_z;

static void prepare_line1() {
    // prepare_steps(stepper *smotor,
    //     long step_count, unsigned long step_delay,
    //     calibrate_mode_t calibrate_mode=NONE);

    // make 20000 steps with 1000 microseconds delay
    // X.pos would go from 0 to
    // 7500*20000=150000000 nanometers = 150000 micrometers = 150 millimeters
    // during 1000*20000=20000000microseconds=20seconds
    prepare_steps(&sm_x, 20000, 1000);
    // make 10000 steps with 2000 microseconds delay
    // Y.pos would go from 0 to
    // 7500*10000=75000000 nanometers = 75000 micrometers = 75 millimeters
    // during 2000*10000=20000000microseconds=20seconds
    prepare_steps(&sm_y, 10000, 2000);
    // make 1000 steps with 20000 microseconds delay
    // Z.pos would go from 0 to
    // 7500*1000=7500000 nanometers = 7500 micrometers  = 7.5 millimeters
    // during 20000*1000=20000000microseconds=20seconds
    prepare_steps(&sm_z, 1000, 20000);
}

void setup() {
    Serial.begin(9600);
    Serial.println("Starting stepper_h test...");
    
    // connected stepper motors
    // init_stepper(stepper* smotor, char name,
    //     int pin_step, int pin_dir, int pin_en,
    //     bool invert_dir, int step_delay,
    //     int distance_per_step)
    // init_stepper_ends(stepper* smotor,
    //     end_strategy min_end_strategy, end_strategy max_end_strategy,
    //     long long min_pos, long long max_pos);
    
    // X
    init_stepper(&sm_x, 'x', 8, 9, 10, false, 1000, 7500);
    init_stepper_ends(&sm_x, NO_PIN, NO_PIN, CONST, CONST, 0, 300000000);
    // Y
    init_stepper(&sm_y, 'y', 5, 6, 7, true, 1000, 7500);
    init_stepper_ends(&sm_y, NO_PIN, NO_PIN, CONST, CONST, 0, 216000000);
    // Z
    init_stepper(&sm_z, 'z', 2, 3, 4, true, 1000, 7500);
    init_stepper_ends(&sm_z, NO_PIN, NO_PIN, CONST, CONST, 0, 100000000);
    
    // configure motors before starting steps
    prepare_line1();
    // start motors, non-blocking
    stepper_start_cycle();
}

void loop() {
    static int prevTime = 0;
    // Debug messages - print current positions of motors once per second
    // while they are rotating, once per 10 seconds when they are stopped
    int currTime = millis();
    if( (stepper_cycle_running() && (currTime - prevTime) >= 1000) || (currTime - prevTime) >= 10000 ) {
        prevTime = currTime;
        Serial.print("X.pos=");
        Serial.print(sm_x.current_pos, DEC);
        Serial.print(", Y.pos=");
        Serial.print(sm_y.current_pos, DEC);
        Serial.print(", Z.pos=");
        Serial.print(sm_z.current_pos, DEC);
        Serial.println();
    }
    
    // put any code here, it would run while the motors are rotating
}
```

even if you don't have stepper motor with step-dir driver, you can check out output in the serial monitor window (this one goes from my ChipKIT Uno32)

```
Starting stepper_h test...
X.pos=6937500, Y.pos=3525000, Z.pos=352500
X.pos=14437500, Y.pos=7275000, Z.pos=727500
X.pos=21930000, Y.pos=11025000, Z.pos=1102500
X.pos=29430000, Y.pos=14775000, Z.pos=1477500
X.pos=36922500, Y.pos=18525000, Z.pos=1852500
X.pos=44422500, Y.pos=22267500, Z.pos=2227500
X.pos=51915000, Y.pos=26017500, Z.pos=2602500
X.pos=59415000, Y.pos=29767500, Z.pos=2977500
X.pos=66907500, Y.pos=33517500, Z.pos=3352500
X.pos=74407500, Y.pos=37260000, Z.pos=3727500
X.pos=81900000, Y.pos=41010000, Z.pos=4102500
X.pos=89400000, Y.pos=44760000, Z.pos=4477500
X.pos=96892500, Y.pos=48510000, Z.pos=4852500
X.pos=104392500, Y.pos=52260000, Z.pos=5227500
X.pos=111885000, Y.pos=56010000, Z.pos=5602500
X.pos=119385000, Y.pos=59752500, Z.pos=5977500
X.pos=126877500, Y.pos=63502500, Z.pos=6352500
X.pos=134377500, Y.pos=67252500, Z.pos=6727500
X.pos=141870000, Y.pos=71002500, Z.pos=7102500
X.pos=149370000, Y.pos=74745000, Z.pos=7477500
X.pos=150000000, Y.pos=75000000, Z.pos=7500000
```

Actually, this lib has some more features like counting steps for each motor, tracking working tool virtual position, making steps with dynamic step delay (to draw curves) etc. Some of them are far from being finished, but some already work mostly fine. Will provide more examples if someone is interested here.

some older videos with older version of this stepper_h lib + ChipKIT + CNC

https://vimeo.com/133592759  
https://vimeo.com/93176233  
https://vimeo.com/93395529

---

# Note for example sketch compile error

Unfortunately, provided above example won't compile with upstream
Arduino (both Arduino and ChipKIT platforms) due to lack of support
of 64-bit values in Serial.println(xxx) functions:
Serial.println(int64_t, DEC) is missing

To fix this issue, copy patched 3pty/arduino/Print.cpp and 3pty/arduino/Print.h to:

for Arduino platform  
~/.arduino15/packages/arduino/hardware/avr/1.6.19/cores/arduino/

for ChipKIT platform  
~/.arduino15/packages/chipKIT/hardware/pic32/1.4.3/cores/pic32/

This is required to compile example sketch:

~~~cpp
    Serial.print(sm_x.current_pos, DEC);
~~~

(sm_x.current_pos has int64_t/"long long" data type)

Or remove/replace this line in example sketch,
patched Print is not required to compile stepper_h library core.

patched version of Print by
Rob Tillaart https://github.com/RobTillaart

Code to print int64_t and uint64_t for UNO (and maybe DUE)  
http://forum.arduino.cc/index.php/topic,143584.0.html  
https://github.com/arduino/Arduino/issues/1236

---
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ—Ç–æ—Ä–æ–≤
https://github.com/1i7/stepper_h/issues/16  
https://github.com/1i7/stepper_h/issues/23

–î–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º
- –ê—Ä–¥—É–∏–Ω–æ-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–Ω–∞—è –ø–ª–∞—Ç–∞ ChipKIT Uno32 (—á–∏–ø PIC32MX, 80–ú–ì—Ü)
- CNC-—à–∏–ª–¥ –ê—Ä–¥—É–∏–Ω–æ
- –¥—Ä–∞–π–≤–µ—Ä STEP-DIR Pololu-DRV8825 ("—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥—Ä–∞–π–≤–µ—Ä")
https://ru.aliexpress.com/item/20pcs-lot-StepStick-DRV8825-Stepper-Driver-Pololu-Reprap-4layer-PCB-Sanguinololu-RAMPS/32417447864.html?spm=a2g0v.10010108.1000016.1.38f7f7319jDHWL&isOrigTitle=true
- –®–∞–≥–æ–≤—ã–µ –º–æ—Ç–æ—Ä—ã 17HS4401 (–ø–æ–±–æ–ª—å—à–µ; 1.7–ê 0.42N.M), 17HS3401 (c—Ä–µ–¥–Ω–∏–π), 17HS2408 (—Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π).

–ü–æ—Å—á–∏—Ç–∞–µ–º —Å–∞–º—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –ª–æ–≥–∏–∫–∏:
- –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ –º–æ—Ç–æ—Ä–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–µ–ª–∏—Ç–µ–ª—è —à–∞–≥–∞ (–¥—Ä–∞–π–≤–µ—Ä+–º–æ—Ç–æ—Ä)
- –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Ç–∞–π–º–µ—Ä–∞ –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–æ—Ç–æ—Ä–∞–º–∏ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é (–¥—Ä–∞–π–≤–µ—Ä+–º–æ—Ç–æ—Ä+–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
- –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–∏–ø–æ–≤—ã—Ö –ø–µ—Ä–µ–¥–∞—Ç–æ—á–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤

## –ü—Ä–æ–≤–æ–¥–∞
–ú–æ—Ç–æ—Ä—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –¥—Ä–∞–π–≤–µ—Ä—É 4-–∂–∏–ª—å–Ω—ã–º —à–ª–µ–π—Ñ–æ–º. –¢–∞–∫ –ø–æ–ª—É—á–∏–ª–æ—Å—å, —á—Ç–æ –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–æ–¥–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –º–æ—Ç–æ—Ä–∞ –∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –¥—Ä–∞–π–≤–µ—Ä–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è (—Ö–æ—Ç—è –≤ –∫—É–ø–ª–µ–Ω–Ω–æ–º –ø—Ä–æ–≤–æ–¥–µ –æ–Ω–∏ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –±—É–¥—É—Ç –∏–¥—Ç–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É - –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏—Ö –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—Ç–∞–≤–∏—Ç—å).

–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –º–æ—Ç–æ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: —Å–∏–Ω–∏–π, –∫—Ä–∞—Å–Ω—ã–π, –∑–µ–ª–µ–Ω—ã–π, —á–µ—Ä–Ω—ã–π.
–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –¥—Ä–∞–π–≤–µ—Ä–∞ –ø—Ä–∏ —ç—Ç–æ–º: —Å–∏–Ω–∏–π, –∑–µ–ª–µ–Ω—ã–π, —á–µ—Ä–Ω—ã–π, –∫—Ä–∞—Å–Ω—ã–π.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ–≤–æ–¥–∞ –ø—Ä–∏–µ—Ö–∞–ª–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –ø–æ—Ä—è–¥–∫–æ–º —Å –æ–±–æ–∏—Ö –∫–æ–Ω—Ü–æ–≤, –ø–æ—ç—Ç–æ–º—É —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã –Ω–∞ –æ–±–º–æ—Ç–∫–∏ —à–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º –æ–±—Ä–∞–∑–æ–º, –¥—Ä–∞–π–≤–µ—Ä –≥—Ä–µ–ª—Å—è, –º–æ—Ç–æ—Ä –≥—Ä–µ–ª—Å—è, —Ö–æ—Ç—è –∏ –ø–æ–¥–∞–≤–∞–ª –ø—Ä–∏–∑–Ω–∞–∫–∏ –∂–∏–∑–Ω–∏.

–°–ø–∞—Å–∏–±–æ –ò–≥–æ—Ä—é –ì–µ—Ä–∞—Å–∏–º–æ–≤—É –∑–∞ —Ñ–∏–∫—Å, –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ –∫—Ä—É—Ç–∏—Ç—Å—è.

## –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞
–°—é–¥–∞ –∂–µ –±–æ–Ω—É—Å–æ–º - –ø—Ä–∞–≤–∏–ª–æ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ –ø–æ–¥ –º–æ—Ç–æ—Ä

> –§–æ—Ä–º—É–ª–∞ —Å–∞–º–∞—è –ø—Ä–æ—Å—Ç–∞—è :
> 1) —Å–∏–ª–∞ —Ç–æ–∫–∞ —Ä–∞–±–æ—á–∞—è —à–∞–≥–æ–≤–æ–≥–æ –º–æ—Ç–æ—Ä–∞ –±–µ—Ä—ë—Ç—Å—è
> 2) –∑–Ω–∞—á–µ–Ω–∏–µ Vref = Current Limit / 2
> 
> —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ - —Å–∏–ª–∞ —Ç–æ–∫–∞ –ø–æ–¥–µ–ª–∏—Ç—å –Ω–∞ Vref = –≤–æ–ª—å—Ç—ã
> 
> –±–µ—Ä—ë—à—å –º—É–ª—å—Ç–∏–º–µ—Ç—Ä —Å—Ç–∞–≤–∏—à—å –Ω–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤–æ–ª—å—Ç (–Ω–∞ 20) –∏ –∏–∑–º–µ—Ä—è–µ—à—å. –ü–ª—é—Å–æ–≤–æ–π —â—É–ø —Å—Ç–∞–≤–∏—à—å –Ω–∞ —Ä–µ–∑–∏—Å—Ç–æ—Ä –∫—Ä—É—Ç—è—â–∏–π—Å—è, –º–∏–Ω—É—Å–æ–≤–æ–π –Ω–∞ –º–∏–Ω—É—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ. –°–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ –Ω–µ –æ—Ç—Å–æ–µ–¥–∏–Ω—è—Ç—å –º–æ—Ç–æ—Ä –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º –ø–∏—Ç–∞–Ω–∏–∏ –ò–ë–ü.
> 
> –º—ã –±—Ä–∞–ª–∏ –¥–≤–∏–∂–∫–∏
> 1.7 –∞–º–ø–µ—Ä–∞
> 0.6 –∞–º–ø–µ—Ä–∞
> 1.3 –∞–º–ø–µ—Ä–∞
> 
> –≤—ã–≤–æ–¥ —Ñ–æ—Ä–º—É–ª—ã :
> 1.7/2=0.85 –≤–æ–ª—å—Ç–∞ ( –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∑–∏—Å—Ç–æ—Ä –ø—Ä–∏–º–µ—Ä–Ω–æ 0.75 - 0.80 )
> 0.6/2=0.3 ( 0.2 - 0.25 )
> 1.3/2=0.65 ( 0.55 - 0.60 )
> 
> –ú–æ—Ç–æ—Ä –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–∏—â–∞—Ç—å –∂—É–∂–∂–∞—Ç—å –∏ —Ç–ø . üòä


## –î–µ–ª–∏—Ç–µ–ª–∏ —à–∞–≥–∞

–ù–∞ –º–æ—Ç–æ—Ä-—à–∏–ª–¥–µ –ø–µ—Ä–µ–º—ã—á–∫–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–µ–ª–∏—Ç–µ–ª—è —à–∞–≥–∞ –ø–æ–º–µ—á–µ–Ω—ã M0, M1, M2

–ú–æ—Ç–æ—Ä 2-—Ö —Ñ–∞–∑–Ω—ã–π, –ø–æ–ª–Ω—ã–π –æ–±–æ—Ä–æ—Ç - 200 —à–∞–≥–æ–≤.

–í–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–ª–∏—Ç–µ–ª–µ–π —à–∞–≥–∞: 1/1 (–±–µ–∑ –¥–µ–ª–µ–Ω–∏—è), 1/2, 1/4, 1/8, 1/16, 1/32

–ø–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä–µ–º—ã—á–µ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ–ª–∏—Ç–µ–ª–µ–π:

- 1/1: M0=0, M1=0, M2=0 (000)
- 1/2: M0=1, M1=0, M2=0 (100)
- 1/4: M0=0, M1=1, M2=0 (010)
- 1/8: M0=1, M1=1, M2=0 (110)
- 1/16: M0=0, M1=0, M2=1 (001)
- 1/32: M0=1, M1=1, M2=1 (111)

## –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏.

–ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ç–µ—Å—Ç–æ–≤ –≤—ã–¥–µ–ª—è—é 4 –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ—Ç–æ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏:  
https://github.com/1i7/stepper_h/blob/master/test-sketches/step_dir_test/step_dir_test.ino

- –º–æ—Ç–æ—Ä –ø–∏—â–∏—Ç –∏ –Ω–µ –∫—Ä—É—Ç–∏—Ç—Å—è
- –º–æ—Ç–æ—Ä –≥—É–¥–∏—Ç –∏ –Ω–µ –∫—Ä—É—Ç–∏—Ç—Å—è
- –º–æ—Ç–æ—Ä –∫—Ä—É—Ç–∏—Ç—Å—è, –Ω–æ –µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –ø–∞–ª—å—Ü–µ–º, —Å–∞–º –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç
- –º–æ—Ç–æ—Ä –∫—Ä—É—Ç–∏—Ç—Å—è –∏ –µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –ø–∞–ª—å—Ü–µ–º, —Å–∞–º –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ

–ß–µ–º –º–µ–Ω—å—à–µ –¥–µ–ª–∏—Ç–µ–ª—å —à–∞–≥–∞, —Ç–µ–º –±–æ–ª–µ–µ —Ä–∞–∑–º—ã—Ç–∞ –≥—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–≥—Ä–∞–Ω–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –ø–∞–ª—å—Ü–µ–º, —Å–∞–º –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç" –∏–Ω–æ–≥–¥–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ, –∞ –∏–Ω–æ–≥–¥–∞ –º–æ—Ç–æ—Ä –º–æ–∂–µ—Ç –≤–∑—è—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å. –ï—Å–ª–∏ "–º–æ—Ç–æ—Ä –≥—É–¥–∏—Ç –∏ –Ω–µ –∫—Ä—É—Ç–∏—Ç—Å—è", —Ç–æ –º–æ–∂–Ω–æ –µ–≥–æ –Ω–µ–º–Ω–æ–≥–æ –∫—Ä—É—Ç–∞–Ω—É—Ç—å –ø–∞–ª—å—Ü–µ–º –∏ –æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç –∫—Ä—É—Ç–∏—Ç—Å—è. –ò–ª–∏ –≤ —Ä–µ–∂–∏–º–µ –±–µ–∑ –¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ 600 –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥ –º–æ—Ç–æ—Ä –≤—Ä–æ–¥–µ –∫–∞–∫ –ø–∏—â–∏—Ç –∏ –¥–∞–∂–µ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∫—Ä—É—Ç–∞–Ω—É—Ç—å –ø–∞–ª—å—Ü–µ–º –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—Ä–∞—â–∞—Ç—å—Å—è, –Ω–æ –µ—Å–ª–∏ –ø–ª–∞–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ 3-4 —Ä–∞–∑–∞, —Ç–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—Ä–∞—â–µ–Ω–∏–µ.

–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Ä–µ–∂–∏–º—ã "—Å–∞–º –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç" –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –≤ —Ä–∞–±–æ—á–∏–π –¥–∏–∞–ø–∞–∑–Ω –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –º–æ—Ç–æ—Ä –Ω–µ —Å—Ä–∞–∑—É –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏, –∞ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –Ω–µ–º—É –ø–ª–∞–≤–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ. –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤—Ä–∞—â–µ–Ω–∏–∏ –º–æ—Ç–æ—Ä –≤—Å–µ —Ä–∞–≤–Ω–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å—Ç–æ–ø–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–µ.

–¢–∞–∫ –∂–µ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –≥—Ä–∞–Ω–∏—Ü—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –±—É–¥—É—Ç –ø–ª–∞–≤–∞—Ç—å –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¥—Ä–∞–π–≤–µ—Ä–∞ (–≤—Å–µ —Ç–µ–∫—É—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª–∏—Å—å –≤ –æ–¥–Ω–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞).

–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ–ª–∏—Ç–µ–ª–µ–π (–∫—Ä—É—Ç–∏—Ç—Å—è –æ–∫, –µ—Å–ª–∏ –ø—Ä–∏—Ç–æ—Ä–º–æ–∑–∏—Ç—å, —Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ–ª—é–±–æ–º—É):
- 1/1: 1500 –º–∫—Å
- 1/2: 650 –º–∫—Å
- 1/4: 330 –º–∫—Å
- 1/8: 180 –º–∫—Å
- 1/16: 80 –º–∫—Å
- 1/32: 40 –º–∫—Å

## –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –≤—Ä–∞—â–µ–Ω–∏—è

–ü–æ—Å—á–∏—Ç–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—Ä–∞—â–µ–Ω–∏—è  
https://github.com/1i7/stepper_h/blob/master/test-sketches/step_dir_test/step_dir_test.ino  
https://github.com/1i7/stepper_h/blob/master/test-sketches/stepper_modes/stepper_modes.ino

- 1/1: 200 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç
- 1/2: 200 * 2 = 400 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç
- 1/4: 200 * 4 = 800 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç
- 1/8: 200 * 8 = 1600 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç
- 1/16: 200 * 16 = 3200 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç
- 1/32: 300 * 32 = 6400 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç

–°–∫–æ—Ä–æ—Å—Ç–∏
- 1/1: 1500–º–∫—Å/—à–∞–≥ (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)  
1500–º–∫—Å/—à–∞–≥*200—à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç=300000–º–∫—Å/–æ–±=300–º–ª—Å/–æ–±=0.3—Å/–æ–±  
–º–∞–∫—Å.—Å–∫ = 1/0.3–æ–±/—Å–µ–∫ = **3.3 –æ–±/—Å–µ–∫**

- 1/1: 1000–º–∫—Å/—à–∞–≥ (–∫—Ä—É—Ç–∏—Ç —Å —Ç–æ–ª—á–∫–∞)  
1000–º–∫—Å/—à–∞–≥*200—à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç=200000–º–∫—Å/–æ–±=200–º–ª—Å/–æ–±=0.2—Å/–æ–±  
–º–∞–∫—Å.—Å–∫=1/0.2 = **5 –æ–±/—Å–µ–∫**

- 1/2: 650–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)  
650–º–∫—Å/—à–∞–≥*400—à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç=260000–º–∫—Å/–æ–±=260–º–ª—Å/–æ–±=0.260—Å/–æ–±  
–º–∞–∫—Å.—Å–∫=1/0.260–æ–±/—Å = **3.8 –æ–±/—Å–µ–∫**

- 1/4: 330–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)  
330–º–∫—Å/—à–∞–≥*800—à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç=264000–º–∫—Å/–æ–±=264–º–ª—Å/–æ–±=0.264—Å/–æ–±  
–º–∞–∫—Å.—Å–∫=1/0.264–æ–±/—Å = **3.8 –æ–±/—Å–µ–∫**

- 1/8: 180–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)  
180–º–∫—Å/—à–∞–≥*1600—à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç=288000–º–∫—Å/–æ–±=288–º–ª—Å/–æ–±=0.288—Å/–æ–±  
–º–∞–∫—Å.—Å–∫=1/0.288–æ–±/—Å = **3.8 –æ–±/—Å–µ–∫**

- 1/16: 80–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)  
80–º–∫—Å/—à–∞–≥*3200—à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç=256000–º–∫—Å/–æ–±=256–º–ª—Å/–æ–±=0.256—Å/–æ–±  
–º–∞–∫—Å.—Å–∫=1/0.256–æ–±/—Å = **3.9 –æ–±/—Å–µ–∫**

- 1/32: 60–º–∫—Å/—à–∞–≥ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º –ª—É—á—à–∏–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –Ω–æ –¥–µ—Ä–∂–∏—Ç 3 –º–æ—Ç–æ—Ä–∞ –Ω–∞ ChipKIT —Å PIC32MX)  
60–º–∫—Å/—à–∞–≥*6400—à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç=384000–º–∫—Å/–æ–±=384–º–ª—Å/–æ–±=0.384—Å/–æ–±  
–º–∞–∫—Å.—Å–∫=1/0.384–æ–±/—Å–µ–∫ = **2.6 –æ–±/—Å–µ–∫**

- 1/32: 40–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, 2 –º–æ—Ç–æ—Ä–∞ –Ω–∞ ChipKIT —Å PIC32MX)  
40–º–∫—Å/—à–∞–≥*6400—à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç=256000–º–∫—Å/–æ–±=256–º–ª—Å/–æ–±=0.256—Å/–æ–±  
–º–∞–∫—Å.—Å–∫=1/0.256–æ–±/—Å = **3.9 –æ–±/—Å–µ–∫**

- 1/32: 30 –º–∫—Å/—à–∞–≥ (—á—É—Ç—å –º–µ–Ω–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π, —á–µ–º 40 - —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏–∑ —Ä–∞–±–æ—á–∏—Ö)  
30–º–∫—Å/—à–∞–≥*6400—à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç=192000–º–∫—Å/–æ–±=192–º–ª—Å/–æ–±=0.192—Å/–æ–±  
–º–∞–∫—Å.—Å–∫=1/0.192–æ–±/—Å–µ–∫ = **5.2 –æ–±/—Å–µ–∫**

–í –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∏–ª–∏, —á—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –Ω–∞ –≤—Å–µ—Ö –¥–µ–ª–∏—Ç–µ–ª—è—Ö –ø–æ–ª—É—á–∞–µ—Ç—Å—è –≤ —Ä–∞–π–æ–Ω–µ ~4–æ–±/—Å–µ–∫.

## –õ–∏–Ω–µ–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
–ü–æ—Å—á–∏—Ç–∞–µ–º –¥–ª–∏–Ω—É —à–∞–≥–∞ –∏ –ª–∏–Ω–µ–π–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è —Ä–µ–º–µ–Ω–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏.

–ë–µ—Ä–µ–º —à–∫–∏–≤ GT2:
- 20 –∑—É–±–æ–≤
- —à–∞–≥ –∑—É–±–∞ 2–º–º (–ø–æ —Å–ª–æ–≤–∞–º –ò–≥–æ—Ä—è)

—Ç–∏–ø–∞ —Ç–∞–∫–æ–≥–æ
https://ru.aliexpress.com/item/2GT-timing-belt-wheel-16-teeth-20-teeth-width-6mm-inner-hole-5-8mm-for-DIY/32728094223.html?spm=a2g0v.10010108.1000016.1.fb88affc9Zvzz&isOrigTitle=true

–ü–æ –ª–æ–≥–∏–∫–µ –≤–µ—â–µ–π –ø–æ–ª–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ —à–∫–∏–≤–∞ –±—É–¥–µ—Ç
L=2–º–º*20–∑—É–±–æ–≤=40–º–º

—Ç.–µ. –∑–∞ –ø–æ–ª–Ω—ã–π –æ–±–æ—Ä–æ—Ç –º–æ—Ç–æ—Ä –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç 40–º–º (=40000–º–∫–º) –¥–ª–∏–Ω—ã —Ä–µ–º–Ω—è.

–î–ª–∏–Ω–∞ —à–∞–≥–∞ –±—É–¥–µ—Ç:
- 1/1: 200 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç, —à–∞–≥=40000–º–∫–º/200 = **200 –º–∫–º** = 200000 –Ω–º
- 1/2: 200 * 2 = 400 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç, —à–∞–≥=40000–º–∫–º/400 = **100 –º–∫–º** = 100000 –Ω–º
- 1/4: 200 * 4 = 800 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç, —à–∞–≥=40000–º–∫–º/800 = **50 –º–∫–º** = 50000 –Ω–º
- 1/8: 200 * 8 = 1600 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç, —à–∞–≥=40000–º–∫–º/1600 = **25 –º–∫–º** = 25000 –Ω–º
- 1/16: 200 * 16 = 3200 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç, —à–∞–≥=40000–º–∫–º/3200 = **12.5 –º–∫–º** = 12500 –Ω–º
- 1/32: 300 * 32 = 6400 —à–∞–≥–æ–≤/–æ–±–æ—Ä–æ—Ç, —à–∞–≥=40000–º–∫–º/6400 = **6.25 –º–∫–º** = 6250 –Ω–º


–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–∫–æ—Ä–æ—Å—Ç–∏ (–¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ –≥–∞–±–∞—Ä–∏—Ç–æ–≤: A4:210√ó297 –º–º)

- 1/1: 1500–º–∫—Å/—à–∞–≥ (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
–º–∞–∫—Å.—Å–∫ = 3.3 –æ–±/—Å–µ–∫
–º–∞–∫—Å.—Å–∫ (—à–∫–∏–≤) = 40000–º–∫–º/–æ–± * 3.3–æ–±/—Å= 132000–º–∫–º/—Å = **132 –º–º/—Å** = 13.2 —Å–º/—Å

- 1/2: 650–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
–º–∞–∫—Å.—Å–∫ = 3.8 –æ–±/—Å–µ–∫
–º–∞–∫—Å.—Å–∫ (—à–∫–∏–≤) = 40000–º–∫–º/–æ–± * 3.8–æ–±/—Å = 152000–º–∫–º/—Å = **152 –º–º/—Å** = 15.2 —Å–º/—Å

- 1/4: 330–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
–º–∞–∫—Å.—Å–∫ = 3.8 –æ–±/—Å–µ–∫
–º–∞–∫—Å.—Å–∫ (—à–∫–∏–≤) = 40000–º–∫–º/–æ–± * 3.8–æ–±/—Å = 152000–º–∫–º/—Å = **152 –º–º/—Å** = 15.2 —Å–º/—Å

- 1/8: 180–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
–º–∞–∫—Å.—Å–∫ = 3.8 –æ–±/—Å–µ–∫
–º–∞–∫—Å.—Å–∫ (—à–∫–∏–≤) = 40000–º–∫–º/–æ–± * 3.8–æ–±/—Å = 152000–º–∫–º/—Å = **152 –º–º/—Å** = 15.2 —Å–º/—Å

- 1/16: 80–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
–º–∞–∫—Å.—Å–∫ = 3.9 –æ–±/—Å–µ–∫
–º–∫—Å.—Å–∫ (—à–∫–∏–≤) = 40000–º–∫–º/–æ–± * 3.9–æ–±/—Å = 156000–º–∫–º/—Å = **156 –º–º/—Å** = 15.6 —Å–º/—Å

- 1/32: 60–º–∫—Å/—à–∞–≥ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º –ª—É—á—à–∏–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –Ω–æ –¥–µ—Ä–∂–∏—Ç 3 –º–æ—Ç–æ—Ä–∞ –Ω–∞ ChipKIT —Å PIC32MX)
–º–∞–∫—Å.—Å–∫ = 2.6 –æ–±/—Å–µ–∫
–º–∞–∫—Å.—Å–∫ (—à–∫–∏–≤) = 40000–º–∫–º/–æ–± * 2.6–æ–±/—Å= 104000–º–∫–º/—Å = **104 –º–º/—Å** = 10.4 —Å–º/—Å

- 1/32: 40–º–∫—Å/—à–∞–≥ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, 2 –º–æ—Ç–æ—Ä–∞ –Ω–∞ ChipKIT —Å PIC32MX)
–º–∞–∫—Å.—Å–∫ = 3.9 –æ–±/—Å–µ–∫
–º–∫—Å.—Å–∫ (—à–∫–∏–≤) = 40000–º–∫–º/–æ–± * 3.9–æ–±/—Å = 156000–º–∫–º/—Å = **156 –º–º/—Å** = 15.6 —Å–º/—Å

- 1/32: 30–º–∫—Å/—à–∞–≥ (—á—É—Ç—å –º–µ–Ω–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π, —á–µ–º 40 - —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏–∑ —Ä–∞–±–æ—á–∏—Ö)
–º–∞–∫—Å.—Å–∫ = 5.2 –æ–±/—Å–µ–∫
–º–∞–∫—Å.—Å–∫ (—à–∫–∏–≤) = 40000–º–∫–º/–æ–± * 5.2–æ–±/—Å= 208000–º–∫–º/—Å = **208 –º–º/—Å** = 20.8 —Å–º/—Å

~~~cpp
// 1/1, 132 mm/s
int _step_delay_us = 1500; // us
int _dist_per_step = 200000; // nm
init_stepper(&sm_x, 'x', STEP_PIN, DIR_PIN, EN_PIN, false, _step_delay_us, _dist_per_step);

// 1/2, 152 mm/s
int _step_delay_us = 650; // us
int _dist_per_step = 100000; // nm
init_stepper(&sm_x, 'x', STEP_PIN, DIR_PIN, EN_PIN, false, _step_delay_us, _dist_per_step);

// 1/4, 152 mm/s
int _step_delay_us = 330; // us
int _dist_per_step = 50000; // nm
init_stepper(&sm_x, 'x', STEP_PIN, DIR_PIN, EN_PIN, false, _step_delay_us, _dist_per_step);

// 1/8, 152 mm/s
int step_delay_us = 180; // us
int dist_per_step = 25000; // nm
init_stepper(&sm_x, 'x', STEP_PIN, DIR_PIN, EN_PIN, false, _step_delay_us, _dist_per_step);

// 1/16, 156 mm/s
int step_delay_us = 80; // us
int dist_per_step = 12500; // nm
init_stepper(&sm_x, 'x', STEP_PIN, DIR_PIN, EN_PIN, false, _step_delay_us, _dist_per_step);

// 1/32, 104 mm/s
int step_delay_us = 60; // us
int dist_per_step = 6250; // nm
init_stepper(&sm_x, 'x', STEP_PIN, DIR_PIN, EN_PIN, false, _step_delay_us, _dist_per_step);

// 1/32, 156 mm/s
int step_delay_us = 40; // us
int dist_per_step = 6250; // nm
init_stepper(&sm_x, 'x', STEP_PIN, DIR_PIN, EN_PIN, false, _step_delay_us, _dist_per_step);
~~~

---
# –ü—Ä–æ –±–∞–∑–æ–≤—É—é –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ —Ä–∞–∑–º–µ—Ä—ã —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏

–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–∞—á–∏ –∏ —Å–≤–æ–π—Å—Ç–≤ –ø–µ—Ä–µ–¥–∞—Ç–æ—á–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ (–ø—Ä–æ—â–µ –≤—Å–µ–≥–æ —Å—á–∏—Ç–∞—Ç—å –∑–∞ –Ω–∞–Ω–æ–º–µ—Ç—Ä—ã).

–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö curren_pos, min_pos –∏ max_pos - long long (int64_t), 64-–±–∏—Ç–Ω–æ–µ –∑–Ω–∞–∫–æ–≤–æ–µ —Ü–µ–ª–æ–µ.

–î–ª—è 64-–±–∏—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è current_pos —Ä–∞–∑–º–µ—Ä—ã —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏ —Å –±–∞–∑–æ–≤–æ–π –µ–¥–∏–Ω–∏—Ü–µ–π –Ω–∞–Ω–æ–º–µ—Ç—Ä—ã:  
2^63=9223372036854776000 –Ω–∞–Ω–æ–º–µ—Ç—Ä–æ–≤ /1000/1000/1000 = 9223372037 –º–µ—Ç—Ä–æ–≤ /1000 = 9223372–∫–º (9 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –∫–º).  
–≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã –æ—Ç -9–º–ª–Ω –∫–º –¥–æ 9–º–ª–Ω –∫–º, –≤—Å–µ–≥–æ 18–º–ª–Ω –∫–º (1/3 –ø—É—Ç–∏ –¥–æ –ú–∞—Ä—Å–∞)

64-–±–∏—Ç–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ –Ω–∞ 32-–±–∏—Ç–Ω—ã—Ö
(—Ç–µ–º –±–æ–ª–µ–µ, –Ω–∞ 16-–±–∏—Ç–Ω—ã—Ö) –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö, –Ω–æ –æ–Ω–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ
–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ libc (–∫–∞–∫ –º–∏–Ω–∏–º—É–º, –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º ChipKIT –∏ Arduino).
–û–Ω–∏ –º–æ–≥—É —Ä–∞–±–æ—Ç–∞—Ç—å —á—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º "—Ä–æ–¥–Ω—ã–µ" (–Ω–∞ 32-–±–∏—Ç–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö)
32-–±–∏—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ long, –Ω–æ –ø–æ—Ç–µ—Ä—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ —Ñ–∞–∫—Ç—É
–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–∞–∂–µ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —á–∞—Å—Ç—è—Ö –∫–æ–¥–∞
(—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥ –Ω–µ –ø–æ–∫–∞–∑–∞–ª–æ —Ä–∞–∑–Ω–∏—Ü—ã).

–ü—Ä–∏ —ç—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 64-–±–∏—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç
–Ω–µ –∑–∞–¥—É–º—ã–≤–∞—Ç—å—Å—è –æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü–∞—Ö —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏.

–î–ª—è 32—Ö–±–∏—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è current_pos —Ä–∞–∑–º–µ—Ä—ã —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏ –±—ã–ª–∏ –±—ã:

- –ï—Å–ª–∏ –±—Ä–∞—Ç—å –±–∞–∑–æ–≤—É—é –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è –∑–∞ –Ω–∞–Ω–æ–º–µ—Ç—Ä—ã (1/1000 –º–∏–∫—Ä–æ–º–µ—Ç—Ä–∞),
—Ç–æ –¥–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏ –±—É–¥–µ—Ç –æ—Ç –Ω—É–ª—è –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É:  
  2^31=2147483648-1 –Ω–∞–Ω–æ–º–µ—Ç—Ä–æ–≤/1000/1000/1000=2.15–º–µ—Ç—Ä–∞  
–≤ –æ–±–µ —Å—Ç—Ä–æ–Ω—ã: [-2.15–º, 2.15–º], —Ç.–µ. –≤—Å–µ–≥–æ 4.3 –º–µ—Ç—Ä–∞.

- –î–ª—è –±–∞–∑–æ–≤–æ–π –µ–¥–∏–Ω–∏—Ü—ã –º–∏–∫—Ä–æ–º–µ—Ç—Ä (–º–∏–∫—Ä–æ–Ω) —Ä–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å  
–æ—Ç -2.15–∫–º –¥–æ 2.15–∫–º, –≤—Å–µ–≥–æ 4.3–∫–º.

–î–ª—è 32-–±–∏—Ç–Ω–æ–≥–æ —Å–ª—É—á–∞—è –≤–∞—Ä–∏–∞–Ω—Ç —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏ 4.3 –º–µ—Ç—Ä–∞ (2.15, –µ—Å–ª–∏ —Å—á–∏—Ç–∞—Ç—å –æ—Ç 0)
—Å –Ω–∞–Ω–æ–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è –º–Ω–æ–≥–∏—Ö —Å–ª—É—á–∞–µ–≤ –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ –ø—Ä–∏–µ–º–ª–µ–º, –Ω–æ –ø–æ—á—Ç–∏ –Ω–µ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∞—Å–∞
–¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤.

–í–∞—Ä–∏–∞–Ω—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏ —Å –±–∞–∑–æ–≤–æ–π –∏–¥–∏–Ω–∏—Ü–µ–π –º–∏–∫—Ä–æ–º–µ—Ç—Ä—ã –±–æ–ª–µ–µ, —á–µ–º
–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω, –Ω–æ —Ä–∞–∑–º–µ—Ä —à–∞–≥–∞ –¥–ª—è –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö —Å—Ç–∞–Ω–∫–æ–≤ (—Ö–æ—Ç—è –æ–Ω–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–µ—Ö–∞–Ω–∏–∫–∏
–º–æ–≥—É—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–∞–∫—É—é —Ç–æ—á–Ω–æ—Å—Ç—å) –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∞—Å—Ç–æ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –¥–æ–ª–∏
–º–∏–∫—Ä–æ–Ω (6.15–º–∫–º, 7.5–º–∫–º –∏ —Ç.–ø.), –ø–æ—ç—Ç–æ–º—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ü–µ–ª–µ–≤–æ–π –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è
—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –Ω–∞–Ω–æ–º–µ—Ç—Ä—ã.

---
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –∑–∞ –æ–¥–∏–Ω —Ü–∏–∫–ª prepare_steps

–ù–∞ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–º –¥—Ä–∞–π–≤–µ—Ä–µ —Å –¥–µ–ª–∏—Ç–µ–ª–µ–º —à–∞–≥–∞ 32 –º–æ—Ç–æ—Ä –±—É–¥–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ step_delay=30 –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥ (–æ–∫, —Å–∞–º—ã–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç - 20–º–∫—Å, –Ω–æ –æ–Ω —É–∂–µ –Ω–µ –æ—á–µ–Ω—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π; 10 –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥ - –º–æ—Ç–æ—Ä –ø—Ä–æ—Å—Ç–æ –≥—É–¥–∏—Ç). –ù–∞ PIC32MX (ChipKIT Uno32) —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π stepper_h —Å —Ç–∞–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –º–æ–∂–Ω–æ –∫—Ä—É—Ç–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ 2 –º–æ—Ç–æ—Ä–∞.

–¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–≥–æ–≤ step_count –∑–Ω–∞–∫–æ–≤–æ–µ —Ü–µ–ª–æ–µ (long) –º–æ–∂–Ω–æ –Ω–∞ –æ–¥–∏–Ω —Ü–∏–∫–ª –∑–∞–¥–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤:  
2^31=2147483648

30–º–∫—Å*2147483648—à–∞–≥–æ–≤ = 64424509440–º–∫—Å/1000=64424509—Å–µ–∫—É–Ω–¥/60=1073741824–º–∏–Ω/60= 17895697—á–∞—Å–æ–≤/24=745654–¥–Ω–µ–π/365=2042 –ª–µ—Ç

https://duckduckgo.com/?q=2%5E31*30%2F60%2F60%2F24%2F365&t=canonical&atb=v76-1&ia=calculator

–ø–æ–∂–∞–ª—É–π, —Ö–≤–∞—Ç–∏—Ç –Ω–∞ —Ü–∏–∫–ª –±–µ–∑ int64_t

–¥–ª—è step_delay=20 –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥ (–ø—Ä—è–º —Å–æ–≤—Å–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–æ–º –±—Ä–æ—Å–æ–≤–æ–º –∂–µ–ª–µ–∑–µ)  
2^31*20/60/60/24/365=1361 –≥–æ–¥

https://duckduckgo.com/?q=2%5E31*20%2F60%2F60%2F24%2F365&t=canonical&atb=v76-1&ia=calculator

—á—É—Ç—å –ø–æ–º–µ–Ω—å—à–µ, –Ω–æ, –Ω–∞–≤–µ—Ä–Ω–æ–µ, —Ç–æ–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

–î–ª—è –ø–æ–ª–Ω–æ—Ç—ã –∫–∞—Ä—Ç–∏–Ω—ã, –µ—Å–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å long (32 –±–∏—Ç) –Ω–∞ int (16 –±–∏—Ç –Ω–∞ –ê—Ä–¥—É–∏–Ω–µ), –ø–æ–ª—É—á–∏–º:  
2^15*20/60/60/24=7.5 –¥–Ω–µ–π.

–Ω–µ —Ç–∞–∫ –∫—Ä—É—Ç–æ, –∫–∞–∫ long, –Ω–æ —Ç–æ–∂–µ –Ω–∏—á–µ–≥–æ, –Ω–æ –ø—É—Å—Ç—å –±—É–¥–µ—Ç long

---

# –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

–ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ç–∞–π–º–µ—Ä–∞ handle_interrupts  
https://github.com/1i7/stepper_h/blob/master/stepper_h/stepper_timer.cpp#L824

–Ω–∞ –æ–¥–Ω–æ–º —à–∞–≥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 3 –ø—Ä–∏–µ–º–∞:
- –ø–µ—Ä–≤—ã–π –ø—Ä–æ—Ö–æ–¥ (–∑–∞ 2 –∏–º–ø—É–ª—å—Å–∞ –¥–æ —à–∞–≥–∞) - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã
- –≤—Ç–æ—Ä–æ–π –ø—Ä–æ—Ö–æ–¥ (–∑–∞ 1 –∏–º–ø—É–ª—å—Å –¥–æ —à–∞–≥–∞) - –≤–∑–≤–æ–¥–∏—Ç –Ω–æ–∂–∫—É step –Ω–∞ HIGH
- —Ç—Ä–µ—Ç–∏–π –ø—Ä–æ—Ö–æ–¥ (–∏–ø—É–ª—å—Å —à–∞–≥–∞) - –¥–µ–ª–∞–µ—Ç —à–∞–≥ (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç step –≤ LOW)

–Ω–∞ —Ç—Ä–µ—Ç—å–µ–º –∂–µ –ø—Ä–æ—Ö–æ–¥–µ —Å—Ä–∞–∑—É –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω—É–∂–Ω–æ –ª–∏ –¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥.

